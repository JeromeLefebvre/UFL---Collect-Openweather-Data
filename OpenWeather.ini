[FIELD]
FIELD(1).NAME="TagName"
FIELD(2).NAME="Value"
FIELD(2).TYPE="Number"
FIELD(3).NAME="TimeStamp"
FIELD(3).TYPE="DateTime"
FIELD(3).FORMAT="SECONDS_GMT"


FIELD(4).NAME="Variable_String"

FIELD(5).NAME="weather"

FIELD(6).NAME="WeatherId"

FIELD(5).NAME="coord"

FIELD(6).NAME="coordLon"

FIELD(7).NAME="TagPrefix"

FIELD(8).NAME="StaticAttributes"
FIELD(8).TYPE="Collection"

FIELD(9).NAME="DynamicAttributes"
FIELD(9).TYPE="COllection"

FIELD(10).NAME="CityName"

FIELD(11).NAME="CountryName"

FIELD(12).NAME="main"

[MSG]
MSG(1).NAME="Data"
 
[Data]
Data.FILTER=C1=="*"

StaticAttributes = Clear()
DynamicAttributes = Clear()

' Metadata and timestamp
TagPrefix = "OpenWeather." + JsonGetValue(__MESSAGE, "id") + ".Weather."
CityName = JsonGetValue(__Message, "name")
CountryName = JsonGetValue(JsonGetValue(__Message, "sys"), "country")
TimeStamp = JsonGetValue(__MESSAGE, "dt")
StoreElement(CountryName, "Country")

'Coordinate data
coord = JsonGetValue(__MESSAGE, "coord")
StaticAttributes = Add("longitude", JsonGetValue(coord, "lon"))
StaticAttributes = Add("latitude", JsonGetValue(coord, "lat"))

' weather condition
FOREACH (JsonGetItem(__MESSAGE, "weather[]")) DO
   WeatherId = JsonGetValue(__ITEM, "id")
ENDFOR
StoreEvent(TagPrefix + "Weather.id", "Weather condition id", TimeStamp, WeatherId )
DynamicAttributes = Add("Weather condition id")

' Weather
main = JsonGetValue(__MESSAGE,"main")

StoreEvent(TagPrefix + "main.temp", "Temperature", TimeStamp, JsonGetValue(main,"temp"))
StoreEvent(TagPrefix + "main.pressure", "Pressure", TimeStamp, JsonGetValue(main,"pressure") )
StoreEvent(TagPrefix + "main.humdity", "Humidity", TimeStamp, JsonGetValue(main,"humidity") )
StoreEvent(TagPrefix + "main.temp_min", "Minimum temperature", TimeStamp, JsonGetValue(main,"temp_min") )
StoreEvent(TagPrefix + "main.temp_max", "Maximum temperature", TimeStamp, JsonGetValue(main,"temp_max") )

DynamicAttributes = Add("Temperature")
DynamicAttributes = Add("Pressure")
DynamicAttributes = Add("Humidity")
DynamicAttributes = Add("Minimum temperature")
DynamicAttributes = Add("Maximum temperature")

StoreElement(CountryName + CHAR(92) + CityName, "City", DynamicAttributes, StaticAttributes)